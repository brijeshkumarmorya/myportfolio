<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How I Built a Real-Time Expense Splitting App with Node.js & MongoDB | Brijesh Kumar Morya</title>
  <meta name="description" content="A deep-dive into building PerSplit — a real-time expense splitting app with Node.js, Express, MongoDB, Socket.IO, and Flutter. Covers WebSocket architecture, net-settlement algorithms, and UPI QR integration.">
  <meta name="author" content="Brijesh Kumar Morya">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://brijeshkumarmorya.in/blog/expense-splitting-app-nodejs-mongodb.html">
  <meta property="og:title" content="How I Built a Real-Time Expense Splitting App with Node.js & MongoDB">
  <meta property="og:description" content="Architecture decisions, Socket.IO real-time sync, the net-settlement algorithm, and UPI QR generation behind PerSplit.">
  <meta property="og:url" content="https://brijeshkumarmorya.in/blog/expense-splitting-app-nodejs-mongodb.html">
  <meta property="og:type" content="article">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "How I Built a Real-Time Expense Splitting App with Node.js & MongoDB",
    "description": "A deep-dive into building PerSplit — a real-time expense splitting app using Node.js, Express, MongoDB, Socket.IO, and Flutter.",
    "author": {"@type": "Person","name": "Brijesh Kumar Morya","url": "https://brijeshkumarmorya.in/"},
    "publisher": {"@type": "Person","name": "Brijesh Kumar Morya"},
    "url": "https://brijeshkumarmorya.in/blog/expense-splitting-app-nodejs-mongodb.html",
    "inLanguage": "en-IN",
    "keywords": ["Node.js expense app", "MongoDB expense splitting", "real-time expense tracker", "Socket.IO Node.js", "UPI integration Node.js", "backend developer India"],
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type":"ListItem","position":1,"name":"Home","item":"https://brijeshkumarmorya.in/"},
        {"@type":"ListItem","position":2,"name":"Blog","item":"https://brijeshkumarmorya.in/blog/"},
        {"@type":"ListItem","position":3,"name":"Expense Splitting App with Node.js","item":"https://brijeshkumarmorya.in/blog/expense-splitting-app-nodejs-mongodb.html"}
      ]
    }
  }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--bg:#080f1c;--surface:#0c1526;--surface-2:#101d33;--border:rgba(0,245,212,.08);--border-mid:rgba(0,245,212,.18);--text-head:#e8f4ff;--text-body:#7e92b5;--text-muted:#4a5f80;--text-label:#a0b4cf;--accent:#00F5D4;--accent-dim:rgba(0,245,212,.12);--font-head:'Syne',sans-serif;--font-body:'DM Sans',sans-serif;--font-mono:'JetBrains Mono',monospace}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:var(--font-body);background:var(--bg);color:var(--text-body);line-height:1.7;overflow-x:hidden;-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    /* NAV */
    .navbar{position:fixed;top:0;left:0;right:0;z-index:100;padding:.9rem 0;background:rgba(8,15,28,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border)}
    .nav-inner{max-width:760px;margin:0 auto;padding:0 1.5rem;display:flex;align-items:center;justify-content:space-between}
    .nav-logo{font-family:var(--font-head);font-size:1.2rem;font-weight:800;color:var(--accent)}
    .nav-back{font-family:var(--font-mono);font-size:.82rem;color:var(--text-label);display:flex;align-items:center;gap:.5rem}
    .nav-back:hover{color:var(--accent);text-decoration:none}
    /* ARTICLE */
    .article-wrap{max-width:760px;margin:0 auto;padding:7rem 1.5rem 5rem}
    /* BREADCRUMBS */
    .breadcrumbs{font-family:var(--font-mono);font-size:.75rem;color:var(--text-muted);margin-bottom:2rem;display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .breadcrumbs a{color:var(--text-muted)}
    .breadcrumbs a:hover{color:var(--accent)}
    .breadcrumbs span{color:var(--accent)}
    /* HEADER */
    .article-tags{display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:1.5rem}
    .article-tag{font-family:var(--font-mono);font-size:.72rem;color:var(--accent);background:var(--accent-dim);border:1px solid var(--border-mid);border-radius:100px;padding:.2rem .8rem}
    h1.article-title{font-family:var(--font-head);font-size:clamp(1.8rem,4vw,2.8rem);font-weight:800;color:var(--text-head);line-height:1.15;letter-spacing:-.03em;margin-bottom:1.5rem}
    .article-meta{font-family:var(--font-mono);font-size:.8rem;color:var(--text-muted);margin-bottom:2.5rem;padding-bottom:2rem;border-bottom:1px solid var(--border);display:flex;gap:1.5rem;flex-wrap:wrap}
    .article-meta span{display:flex;align-items:center;gap:.4rem}
    .article-meta i{color:var(--accent)}
    /* CONTENT */
    .article-body h2{font-family:var(--font-head);font-size:1.6rem;font-weight:700;color:var(--text-head);margin:2.5rem 0 1rem;letter-spacing:-.02em}
    .article-body h3{font-family:var(--font-head);font-size:1.2rem;font-weight:600;color:var(--text-label);margin:2rem 0 .75rem}
    .article-body p{font-size:1rem;line-height:1.85;color:var(--text-body);margin-bottom:1.25rem}
    .article-body strong{color:var(--text-label);font-weight:500}
    .article-body ul,.article-body ol{margin:1rem 0 1.5rem 1.5rem;display:flex;flex-direction:column;gap:.5rem}
    .article-body li{font-size:.97rem;color:var(--text-body);line-height:1.75}
    .article-body pre{background:var(--surface);border:1px solid var(--border-mid);border-radius:8px;padding:1.25rem 1.5rem;overflow-x:auto;margin:1.5rem 0;font-family:var(--font-mono);font-size:.83rem;line-height:1.6;color:#a0c4ff}
    .article-body code{font-family:var(--font-mono);font-size:.88em;color:var(--accent);background:var(--accent-dim);padding:.1rem .4rem;border-radius:3px}
    .article-body pre code{color:#a0c4ff;background:none;padding:0;font-size:1em}
    .article-body blockquote{border-left:3px solid var(--accent);padding:1rem 1.5rem;margin:1.5rem 0;background:var(--surface);border-radius:0 8px 8px 0;font-style:italic;color:var(--text-label)}
    /* INTERNAL LINKS */
    .internal-link-box{background:var(--surface);border:1px solid var(--border-mid);border-radius:8px;padding:1rem 1.25rem;margin:2rem 0;display:flex;align-items:center;gap:1rem}
    .internal-link-box i{color:var(--accent);font-size:1.1rem;flex-shrink:0}
    .internal-link-box p{margin:0;font-size:.9rem}
    /* FOOTER */
    .article-footer{margin-top:4rem;padding-top:2rem;border-top:1px solid var(--border)}
    .author-card{display:flex;gap:1rem;align-items:flex-start;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.5rem}
    .author-avatar{width:60px;height:60px;border-radius:50%;background:var(--accent-dim);border:2px solid var(--border-mid);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:var(--font-head);font-weight:800;color:var(--accent);font-size:1.2rem}
    .author-name{font-family:var(--font-head);font-weight:700;color:var(--text-head);margin-bottom:.25rem}
    .author-bio{font-size:.9rem;color:var(--text-body);line-height:1.65}
    .related-posts{margin-top:3rem}
    .related-posts h3{font-family:var(--font-head);font-size:1.2rem;font-weight:700;color:var(--text-head);margin-bottom:1rem}
    .related-list{display:flex;flex-direction:column;gap:.75rem}
    .related-item{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;transition:border-color .2s}
    .related-item:hover{border-color:var(--border-mid);text-decoration:none}
    .related-item i{color:var(--accent);flex-shrink:0}
    .related-item span{font-size:.9rem;color:var(--text-label)}
    footer{margin-top:4rem;border-top:1px solid var(--border);padding:1.5rem;text-align:center;font-family:var(--font-mono);font-size:.75rem;color:var(--text-muted)}
    footer a{color:var(--accent)}
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-inner">
      <a href="/" class="nav-logo">[BKM]</a>
      <a href="/blog/" class="nav-back"><i class="fas fa-arrow-left"></i> All Articles</a>
    </div>
  </nav>

  <article class="article-wrap" itemscope itemtype="https://schema.org/Article">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Home</a> <span>/</span>
      <a href="/blog/">Blog</a> <span>/</span>
      <span>Expense Splitting App</span>
    </nav>

    <div class="article-tags">
      <span class="article-tag">Node.js</span>
      <span class="article-tag">MongoDB</span>
      <span class="article-tag">Socket.IO</span>
      <span class="article-tag">Flutter</span>
      <span class="article-tag">Backend Development</span>
    </div>

    <h1 class="article-title" itemprop="headline">How I Built a Real-Time Expense Splitting App with Node.js &amp; MongoDB</h1>

    <div class="article-meta">
      <span><i class="fas fa-user"></i> Brijesh Kumar Morya</span>
      <span><i class="fas fa-clock"></i> 5 min read</span>
      <span><i class="fas fa-tag"></i> Backend Engineering</span>
    </div>

    <div class="article-body" itemprop="articleBody">
      <p>
        When I started building <strong>PerSplit</strong> — a group expense splitting application — I quickly learned that the hardest part of backend development is not writing CRUD endpoints. The real challenges are <strong>data consistency</strong>, <strong>real-time synchronisation</strong>, and <strong>algorithm design</strong>. In this article I walk through the key engineering decisions I made while building a production-grade Node.js and MongoDB backend for a cross-platform Flutter app.
      </p>

      <h2>The Problem: Why Existing Apps Fall Short</h2>
      <p>
        Most expense-splitting apps — like Splitwise — have a critical UX flaw: they show stale balances and require manual refresh. In a group setting where 5+ people are simultaneously logging expenses from a trip, real-time updates are not a nice-to-have; they are essential. I also noticed that Indian users specifically need <strong>UPI-native payment flows</strong>, something generic international apps completely miss.
      </p>
      <p>
        My goal for PerSplit was clear: a backend that handles group expense tracking, supports multiple split methods (equal, percentage, exact), provides real-time sync via WebSockets, and generates UPI QR codes for instant settlement.
      </p>

      <h2>Architecture Overview</h2>
      <p>
        The stack I chose was deliberate:
      </p>
      <ul>
        <li><strong>Node.js + Express.js</strong> — non-blocking I/O is ideal for WebSocket-heavy workloads</li>
        <li><strong>MongoDB</strong> — flexible document model suits evolving expense schemas</li>
        <li><strong>Socket.IO</strong> — room-based WebSocket management with automatic reconnection</li>
        <li><strong>JWT</strong> — stateless authentication across mobile and web clients</li>
        <li><strong>Flutter</strong> — cross-platform mobile frontend consuming the REST + WebSocket API</li>
      </ul>
      <p>
        I structured the backend using a clean <strong>Controller → Service → Repository</strong> pattern, which I cover in more depth in my article on <a href="backend-systems-clean-architecture.html">Clean Architecture in Node.js</a>.
      </p>

      <h2>The Net-Settlement Algorithm</h2>
      <p>
        The most intellectually interesting part of PerSplit is the <strong>minimise-transactions algorithm</strong>. Naively, if Alice owes Bob ₹300 and Carol ₹200, and Bob owes Carol ₹150, you end up with 3 transactions. The optimal solution reduces this to 2.
      </p>
      <p>
        The algorithm I implemented works as follows:
      </p>
      <ol>
        <li>Compute each participant's net balance (total paid − total owed)</li>
        <li>Separate participants into two lists: creditors (positive balance) and debtors (negative balance)</li>
        <li>Greedily match the largest debtor with the largest creditor</li>
        <li>Settle the minimum of the two amounts, remove the settled party, continue</li>
      </ol>
      <pre><code>// Simplified net settlement — O(n log n)
function minimiseTransactions(balances) {
  const creditors = [], debtors = [];

  for (const [userId, amount] of Object.entries(balances)) {
    if (amount > 0) creditors.push({ userId, amount });
    else if (amount < 0) debtors.push({ userId, amount: -amount });
  }

  creditors.sort((a, b) => b.amount - a.amount);
  debtors.sort((a, b) => b.amount - a.amount);

  const transactions = [];
  let i = 0, j = 0;

  while (i < creditors.length && j < debtors.length) {
    const settle = Math.min(creditors[i].amount, debtors[j].amount);
    transactions.push({
      from: debtors[j].userId,
      to: creditors[i].userId,
      amount: settle
    });
    creditors[i].amount -= settle;
    debtors[j].amount -= settle;
    if (creditors[i].amount === 0) i++;
    if (debtors[j].amount === 0) j++;
  }
  return transactions;
}</code></pre>
      <p>
        This reduces average transaction count by 40–60% compared to a naïve per-expense settlement approach.
      </p>

      <h2>Real-Time Updates with Socket.IO</h2>
      <p>
        Every group in PerSplit maps to a Socket.IO <strong>room</strong>. When any user adds, edits, or deletes an expense, the server broadcasts a diff to all connected group members in under 50ms on a typical network.
      </p>
      <pre><code>// On expense creation
io.to(`group:${groupId}`).emit('expense:created', {
  expense: newExpense,
  updatedBalances: await computeGroupBalances(groupId)
});</code></pre>
      <p>
        I used <code>socket.join()</code> on auth so that each user automatically joins all their groups on connection — no per-request join needed. This reduced socket message overhead by roughly 30%.
      </p>

      <h2>UPI QR Code Generation</h2>
      <p>
        For settlement, I generate UPI deep-link URIs server-side and encode them into QR codes:
      </p>
      <pre><code>const upiLink = `upi://pay?pa=${payeeVpa}&pn=${payeeName}&am=${amount}&cu=INR&tn=PerSplit+Settlement`;
const qrDataUrl = await QRCode.toDataURL(upiLink, { width: 300 });</code></pre>
      <p>
        These QR codes are sent as base64 data URLs and rendered natively in Flutter using the <code>qr_flutter</code> package. No external payment gateway needed — works with any UPI-compatible app (Google Pay, PhonePe, Paytm, etc.).
      </p>

      <h2>Key Lessons for Backend Developers</h2>
      <ul>
        <li><strong>Design your data model around your queries</strong>, not around your entities. MongoDB's flexible schema let me embed expense items and participant shares in a single document, avoiding expensive joins.</li>
        <li><strong>WebSocket rooms are cheap</strong>. Don't be afraid to create one per resource — the memory footprint is minimal.</li>
        <li><strong>Validate at the boundary</strong>. All incoming request bodies go through <code>express-validator</code> middleware before hitting any service layer.</li>
        <li><strong>Idempotency keys matter</strong>. Duplicate expense submissions (due to network retries) must be detected and rejected.</li>
      </ul>

      <div class="internal-link-box">
        <i class="fas fa-link"></i>
        <p>Related: <a href="jwt-authentication-production.html">How I implemented JWT authentication in PerSplit's Node.js backend</a> — access tokens, refresh rotation, and secure cookie storage.</p>
      </div>

      <h2>What I Would Do Differently</h2>
      <p>
        If I rebuilt PerSplit today, I would add <strong>event sourcing</strong> for the expense ledger instead of mutable documents. This would give us a complete audit trail and enable time-travel queries ("what were the balances on day 3 of the trip?"). I would also move the settlement algorithm into a dedicated microservice to allow horizontal scaling.
      </p>

      <h2>Conclusion</h2>
      <p>
        Building PerSplit taught me that backend engineering is fundamentally about <strong>trade-offs</strong>: consistency vs. performance, simplicity vs. flexibility, monolith vs. microservices. The decisions I made here — MongoDB document design, Socket.IO room strategy, the greedy settlement algorithm — were all shaped by understanding the actual usage patterns of the app.
      </p>
      <p>
        If you are a recruiter or engineering team looking for a <strong>backend-focused Node.js developer</strong> who can design real systems, not just connect endpoints to databases — <a href="/#contact">get in touch</a>.
      </p>
    </div>

    <footer class="article-footer">
      <div class="author-card">
        <div class="author-avatar">BK</div>
        <div>
          <div class="author-name">Brijesh Kumar Morya</div>
          <div class="author-bio">Backend-focused Full-Stack Developer and B.Tech CSE student at the University of Delhi. Building scalable Node.js systems, REST APIs, and ML-powered tools. Open to internships and junior engineering roles in Delhi and remotely.</div>
        </div>
      </div>

      <div class="related-posts">
        <h3>Continue Reading</h3>
        <div class="related-list">
          <a href="jwt-authentication-production.html" class="related-item">
            <i class="fas fa-arrow-right"></i>
            <span>Implementing JWT Authentication in Production Node.js Systems</span>
          </a>
          <a href="designing-scalable-rest-apis-btech.html" class="related-item">
            <i class="fas fa-arrow-right"></i>
            <span>Designing Scalable REST APIs as a B.Tech CSE Student</span>
          </a>
          <a href="backend-systems-clean-architecture.html" class="related-item">
            <i class="fas fa-arrow-right"></i>
            <span>Building Backend Systems with Clean Architecture in Node.js</span>
          </a>
        </div>
      </div>
    </footer>
  </article>

  <footer>
    <a href="/">brijeshkumarmorya.in</a> · Backend Developer · B.Tech CSE, University of Delhi
  </footer>
</body>
</html>
